doctype
html(id=id)
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes')
    meta(name='description', content=siteDescription)

    title= siteTitle

    link(rel='stylesheet', href='/css/style.css')
    link(rel='all-the-source', href=source)
    link(rel='author', href='/humans.txt')

    if environment == "production"
      script.
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='https://www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','#{analytics}','auto');ga('send','pageview');

    script.
      document.documentElement.className += ' yes-js';
      //=== Fonts
      var fontUrl = '/css/fonts.c8c5676ae28fd20f3ddd940e8060fb08.woff.json';
      var fontMd5 = 'c8c5676ae28fd20f3ddd940e8060fb08';
      var fontKey = 'fonts';
      var fontCache = null;
      function fontInsert(value) {
        var style = document.createElement('style');
        style.innerHTML = value;
        document.head.appendChild(style);
      }
      // PRE-RENDER
      try {
        fontCache = window.localStorage.getItem(fontKey);
        if (fontCache) {
          fontCache = JSON.parse(fontCache);
          if (fontCache.md5 == fontMd5) {
            fontInsert(fontCache.value);
          } else {
            // Busting cache when md5 doesn't match
            window.localStorage.removeItem(fontKey);
            fontCache = null;
          }
        }
      } catch(e) {
        // Most likely LocalStorage disabled
      }

  body

    style
      each workshop in public._data.workshops
        = '#' + workshop.slug + ' .workshop-header-image{'
        = 'background-image:url(/images/workshops/1x-' + workshop.speaker.photo + ');'
        = '}'

      = '@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {'
      each workshop in public._data.workshops
        = '#' + workshop.slug + ' .workshop-header-image{'
        = 'background-image:url(/images/workshops/2x-' + workshop.speaker.photo + ');'
        = '}'
      = '}'

    section.main#workshop-wrapper(role='region', aria-labelledby='workshops')
      each workshop in public._data.workshops
        script.workshop-template(type='text/template')
          section.workshop-wrapper.workshop-full.sub-hr(id=workshop.slug)
            header.workshop-header
              div.workshop-header-content
                h3.workshop-title(role='heading', aria-level='3')= workshop.title
                div.workshop-details
                  a.workshop-speaker-name(target='_blank' href='https://twitter.com/#{workshop.speaker.twitter}')= workshop.speaker.name
                  div.workshop-date= workshop.details.date
                  div.workshop-time= workshop.details.time

                if config.phase < 4
                  div
                    if config.phase >= 1
                      if config.soldout[workshop.slug]
                        span.button.workshop-button-disabled Sold Out
                      else
                        a.button(href=workshop.ticket.url, target='_blank') Buy tickets
                    else
                      span.button On sale 13 July
              div.workshop-header-image-wrapper
                div.workshop-header-image
            div.workshop-content-wrapper
              if workshop.topics
                h2 What you'll learn on the day
                ul.workshop-list
                  each topic in workshop.topics
                    li
                      h4(role='heading', aria-level='4')=topic.title
                      if topic.description
                        =topic.description

    script.
      var $ = function (s) {
        try {
          return document.querySelectorAll(s);
        } catch (e) {
          return [];
        }
      };
      //=== Fonts
      // POST-RENDER
      if (!fontCache) {
        // Fonts not in LocalStorage or md5 did not match
        window.addEventListener('load', function() {
          var request = new XMLHttpRequest(),
              response;
          request.open('GET', fontUrl, true);
          request.onload = function() {
            if (this.status == 200) {
              try {
                response = JSON.parse(this.response);
                fontInsert(response.value);
                window.localStorage.setItem(fontKey, this.response);
              } catch(e) {
                // LocalStorage is probably full
              }
            }
          };
          request.send();
        });
      }
      //=== Workshops
      var workshopsTemplate = [].slice.call($('script.workshop-template'));
      var len = workshopsTemplate.length;
      var rnd = Math.floor(Math.random() * len);
      var q = workshopsTemplate.splice(rnd, 1);
      document.getElementById('workshop-wrapper').innerHTML = q[0].innerHTML;
